<svg xmlns="http://www.w3.org/2000/svg" width="1000" height="800" viewBox="0 0 1000 800"><defs><marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="black" /></marker></defs><rect width="100%" height="100%" fill="white" /><text x="100" y="40" text_anchor="start" font_family="Arial, sans-serif" font_size="24" font_weight="bold">Loop Transformer Architecture</text><text x="100" y="70" text_anchor="start" font_family="Arial, sans-serif" font_size="16" fill="#555">Config: loop_transformer.yaml | Hidden: 512 | Heads: 8 | Shared Weights (1 Layer)</text><rect x="50" y="250" width="100" height="60" rx="10" ry="10" fill="#e1f5fe" stroke="#0277bd" stroke-width="2" /><text x="100.0" y="275" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="black">Input (X)</text><text x="100.0" y="293" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="black">(Puzzle Emb)</text><rect x="50" y="150" width="100" height="60" rx="10" ry="10" fill="#e0f2f1" stroke="#00695c" stroke-width="2" /><text x="100.0" y="185" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="black">Init z_L</text><rect x="50" y="350" width="100" height="60" rx="10" ry="10" fill="#fff9c4" stroke="#fbc02d" stroke-width="2" /><text x="100.0" y="385" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="black">Init z_H</text><rect x="200" y="100" width="400" height="500" rx="20" ry="20" fill="#f5f5f5" stroke="#9e9e9e" stroke-width="2" /><text x="400" y="130" text_anchor="middle" font_family="Arial, sans-serif" font_size="18" font_weight="bold">Outer Loop (Repeat 3 times)</text><rect x="250" y="160" width="300" height="180" rx="15" ry="15" fill="#e3f2fd" stroke="#1565c0" stroke-width="2" /><text x="400" y="190" text_anchor="middle" font_family="Arial, sans-serif" font_size="16" font_weight="bold" fill="#1565c0">Stage 1 (Repeat 6x)</text><text x="400" y="220" text_anchor="middle" font_family="monospace" font_size="14">z_L &#8592; T(z_L + z_H + X)</text><rect x="350" y="250" width="100" height="50" rx="5" ry="5" fill="#bbdefb" stroke="#1976d2" stroke-width="1" /><text x="400.0" y="270" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="black">Transformer</text><text x="400.0" y="288" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="black">(Shared)</text><rect x="250" y="380" width="300" height="180" rx="15" ry="15" fill="#ffebee" stroke="#c62828" stroke-width="2" /><text x="400" y="410" text_anchor="middle" font_family="Arial, sans-serif" font_size="16" font_weight="bold" fill="#c62828">Stage 2 (Repeat 3x)</text><text x="400" y="440" text_anchor="middle" font_family="monospace" font_size="14">z_H &#8592; T(z_H + z_L)</text><rect x="350" y="470" width="100" height="50" rx="5" ry="5" fill="#ffcdd2" stroke="#d32f2f" stroke-width="1" /><text x="400.0" y="490" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="black">Transformer</text><text x="400.0" y="508" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="black">(Shared)</text><path d="M 150 280 C 200 280, 200 275, 350 275" fill="none" stroke="black" stroke-width="2" marker-end="url(#arrowhead)" /><path d="M 150 180 C 200 180, 220 260, 350 265" fill="none" stroke="black" stroke-width="2" marker-end="url(#arrowhead)" /><path d="M 150 380 C 200 380, 220 290, 350 285" fill="none" stroke="black" stroke-width="2" marker-end="url(#arrowhead)" /><line x1="400" y1="300" x2="400" y2="380" stroke="black" stroke-width="2" marker-end="url(#arrowhead)" /><path d="M 450 275 C 480 275, 480 225, 400 235" fill="none" stroke="black" stroke-width="2" marker-end="url(#arrowhead)" /><path d="M 450 495 C 480 495, 480 445, 400 455" fill="none" stroke="black" stroke-width="2" marker-end="url(#arrowhead)" /><line x1="400" y1="340" x2="400" y2="470" stroke="black" stroke-width="2" marker-end="url(#arrowhead)" /><path d="M 100 410 L 100 500 L 350 500" fill="none" stroke="#fbc02d" stroke-width="2" marker-end="url(#arrowhead)" /><rect x="600" y="320" width="100" height="50" rx="5" ry="5" fill="#e8f5e9" stroke="#2e7d32" stroke-width="1" /><text x="650.0" y="340" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="black">LM Head</text><text x="650.0" y="358" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="black">(Logits)</text><rect x="600" y="420" width="100" height="50" rx="5" ry="5" fill="#fff3e0" stroke="#ef6c00" stroke-width="1" /><text x="650.0" y="440" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="black">Halt Head</text><text x="650.0" y="458" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="black">(Q-values)</text><polygon points="620,530.0 650.0,500 680,530.0 650.0,560" fill="#fff" stroke="#000" stroke-width="2" /><text x="650.0" y="535.0" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="black">Halt?</text><path d="M 550 450 C 580 450, 580 345, 600 345" fill="none" stroke="black" stroke-width="2" marker-end="url(#arrowhead)" /><path d="M 550 490 C 580 490, 580 445, 600 445" fill="none" stroke="black" stroke-width="2" marker-end="url(#arrowhead)" /><line x1="650" y1="470" x2="650" y2="500" stroke="black" stroke-width="2" marker-end="url(#arrowhead)" /><path d="M 650 560 L 650 620 L 180 620 L 180 160 L 250 160" fill="none" stroke="#d32f2f" stroke-width="2" marker-end="url(#arrowhead)" /><text x="400" y="615" text_anchor="middle" font_family="Arial" font_size="12" fill="#d32f2f">No (Continue)</text><line x1="680" y1="530" x2="750" y2="530" stroke="black" stroke-width="2" marker-end="url(#arrowhead)" /><text x="715" y="525" text_anchor="middle" font_family="Arial" font_size="12" fill="#2e7d32">Yes</text><rect x="750" y="500" width="80" height="60" rx="5" ry="5" fill="#e8f5e9" stroke="#2e7d32" stroke-width="2" /><text x="790.0" y="535" font-family="Arial, sans-serif" font-size="14" text-anchor="middle" fill="black">Output</text><path d="M 700 345 C 790 345, 790 450, 790 500" fill="none" stroke="black" stroke-width="2" marker-end="url(#arrowhead)" /><text x="100" y="650" text_anchor="start" font_family="Arial, sans-serif" font_size="12" fill="#777">z_H: High-level state | z_L: Low-level state | T: Transformer Block (RMSNorm -&gt; Attn -&gt; RMSNorm -&gt; MLP)</text></svg>