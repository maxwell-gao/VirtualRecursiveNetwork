program: pretrain.py
method: grid
project: sudoku-sweep-stages
name: stages-hyperparameter-search

parameters:
  # Stage 0 (z_L) parameters
  arch.stages.0.repeat:
    values: [1, 2, 3, 4]

  arch.stages.0.include_inputs:
    values: [true, false]

  # Stage 1 (z_M) parameters
  arch.stages.1.repeat:
    values: [1, 2, 3, 4]

  arch.stages.1.include_inputs:
    values: [true, false]

  # Stage 2 (z_H) parameters
  arch.stages.2.repeat:
    values: [1, 2, 3, 4]

  # Note: Stage 2 does not have include_inputs, so it's not searched

command:
  - ${env}
  - torchrun
  - --nproc-per-node=4
  - pretrain_sweep_wrapper.py
  - arch=loop_transformer-3stage
  - data_paths=[data/sudoku-extreme-1k-aug-1000]
  - evaluators=[]
  - epochs=50000
  - eval_interval=5000
  - lr=1e-4
  - puzzle_emb_lr=1e-4
  - weight_decay=1.0
  - puzzle_emb_weight_decay=1.0
  - grad_clip_norm=-1.0
  - ema=True
  - ${args}

metric:
  name: exact_accuracy
  goal: maximize

early_terminate:
  type: hyperband
  min_iter: 3
  max_iter: 10
  s: 2
  eta: 3

