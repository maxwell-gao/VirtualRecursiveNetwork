program: pretrain.py
method: bayes
project: sudoku-sweep-stages
name: stages-bayesian-optimization

parameters:
  # Stage 0 (z_L) parameters
  arch.stages.0.repeat:
    distribution: int_uniform
    min: 1
    max: 4

  arch.stages.0.include_inputs:
    values: [true, false]

  # Stage 1 (z_M) parameters
  arch.stages.1.repeat:
    distribution: int_uniform
    min: 1
    max: 4

  arch.stages.1.include_inputs:
    values: [true, false]

  # Stage 2 (z_H) parameters
  arch.stages.2.repeat:
    distribution: int_uniform
    min: 1
    max: 4

command:
  - ${env}
  - torchrun
  - --nproc-per-node=4
  - pretrain_sweep_wrapper.py
  - arch=loop_transformer-3stage
  - data_paths="[data/sudoku-extreme-1k-aug-1000]"
  - evaluators="[]"
  - epochs=50000
  - eval_interval=5000
  - lr=1e-4
  - puzzle_emb_lr=1e-4
  - weight_decay=1.0
  - puzzle_emb_weight_decay=1.0
  - grad_clip_norm=-1.0
  - ema=True
  - ${args}

metric:
  name: exact_accuracy
  goal: maximize

early_terminate:
  type: hyperband
  min_iter: 3
  max_iter: 10
  s: 2
  eta: 3
